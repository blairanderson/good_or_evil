<div class="cf mv4">

  <section class="avenir fl-ns w-70-ns">
    <% if @query.length > 0 %>
      <div class="mw7 ml-auto pa3">
        <div class="bg-black-10 f4  pa3">
          Search Results for: <strong><em><%= @query %></em></strong>
        </div>
      </div>
    <% end %>
    <% @lists.each do |list| %>
      <article class="mw7 ml-auto bb b--black-10 ph3">
        <%= link_to(site_list_path(list), class: "db pv4 ph3 ph0-l no-underline black") do %>
          <div class="flex flex-column flex-row-ns">
            <% if list.image %>
              <div class="pr3-ns mb4 mb0-ns w-100 w-40-ns dim">
                <%= attachment_image_tag(list, :image, class: "db") %>
              </div>
            <% end %>
            <div class="w-100 w-60-ns pl3-ns dim">
              <ul class="pa0 ma0 list pb2 mt0 fr">
                <% list.list_items.each_with_index do |item, index| %>
                  <% next unless item.image_id? %>
                  <li class="dib h2 w2 ml3 v-mid">
                    <%= attachment_image_tag(item, :image, alt: item.title, class: "ba b--black-10 db br2 w2 h2") %>
                  </li>
                <% end %>
              </ul>
              <h1 class="f3 fw1 baskerville mt0 lh-title"><%= list.name.html_safe %></h1>
              <small class="db black-50"><%= list.page_views %> page views</small>
              <% product_reviews = list.list_items.count { |i| i.product_link? } %>
              <% if product_reviews > 0 %>
                <small class="db black-50"><%= list.item_count %> product reviews</small>
              <% end %>
              <p class="f6 f5-l lh-copy"><%= truncate(sanitize(list.body, tags: [], attributes: []).strip, length: 120) %></p>
              <p class="f6 lh-copy mv0">By <%= list.user.public_name %></p>
            </div>
          </div>
        <% end %>
      </article>
    <% end %>
    <%= will_paginate(@lists) %>
  </section>
  <aside class="dn db-ns fl-ns w-30-ns">
    <div class="pv4 ph3">
      <form class="pt0 pb4 black-80">
        <div class="measure">
          <input id="search" placeholder="Search the Site..."
                 class="input-reset ba b--black-20 pa3 mb2 db w-100" type="search" name="q">
        </div>
      </form>
      <% if current_history.length > 0 %>
        <hr/>
        <h4 class="tc">Recently Viewed</h4>
        <ul class="list ma0 pa0">
          <% current_history.each do |item| %>
            <li title="<%= item.name %>" class="tc truncate">
              <%= link_to(item.name, item.path, class: "link ttu") %>
            </li>
          <% end %>
        </ul>
        <hr/>
      <% end %>

    </div>
  </aside>
</div>
