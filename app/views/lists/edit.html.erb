<div class="tc"><%= render partial: 'lists/actions' %></div>
<div class="mw8 center">
  <%= render 'lists/form' %>

  <% current_list_items = current_list.list_items.where.not(id: nil).sorted.to_a %>

  <div class="mw7 center" id="sortable">
    <% current_list_items.each_with_index do |list_item, index| %>
      <%= div_for(list_item) do %>
        <%= render partial: 'lists/items/form', locals: {list_item: list_item, index: index, size: current_list_items.size} %>
      <% end %>
    <% end %>
  </div>

  <div class="cf mv4">
    <hr class="mw5 center mv4"/>
    <h4>Add New Section To This Page:</h4>
    <%
       styles = ListItem.available_styles(current_list_items.map(&:style_cd))
       classname = if styles.keys.length == 3
                     "w-third-ns pv2"
                   elsif styles.keys.length == 4
                     "w-25-ns  pv3"
                   else
                     "w-20-ns pv4"
                   end

    %>

    <% styles.each do |name, id| %>
      <%= button_to(account_list_items_path(current_account, current_list, list_item: {style_cd: id}), method: :post,
        class: "fl db w-100 #{classname} link pointer tc bg-black-05 hover-bg-black-10") do %>
        <div class="aspect-ratio aspect-ratio--4x3">
          <div class="aspect-ratio--object pv4">
            <h3 class="f3 fw3 mt0">New <%= name.to_s.titleize %></h3>

            <p class="f5 fw1"><%= t("list_items.style.#{name}") %></p>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>


</div>

<script src="https://cdn.rawgit.com/basecamp/trix/e34a0db3c9e0ca303488227fceb6cd9b33cfdd09/dist/trix.js" charset="utf-8"></script>
<link rel="stylesheet" href="https://cdn.rawgit.com/basecamp/trix/e34a0db3c9e0ca303488227fceb6cd9b33cfdd09/dist/trix.css" media="screen" title="no title" charset="utf-8">
<script !src="">
  function reload() {
    window.location.reload()
  }
  function sortUp(id) {
    var current = $("#list_item_" + id);
    current.prev().before(current);
    sendSort()
  }

  function sortDown(id) {
    var current = $("#list_item_" + id);
    current.next().after(current);
    sendSort()
  }

  function sendSort(){
    $.rails.ajax({
      url: "<%= sort_account_list_items_path(current_account, current_list) %>",
      type: "POST",
      data: $("#sortable").sortable('serialize'),
    }).done(reload)
  }

  $(function() {
    $("#sortable").sortable({
      update: sendSort
    });
  });
</script>

