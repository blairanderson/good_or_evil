<div class="tc"><%= render partial: 'lists/actions' %></div>
<div class="mw7 center">
  <%= render 'lists/form' %>

  <% current_list_items = current_list.list_items.where.not(id: nil).sorted.to_a %>

  <div class="mw7 center" id="sortable">
    <% current_list_items.each_with_index do |list_item, index| %>
      <%= div_for(list_item) do %>
        <%= render partial: 'lists/items/form', locals: {list_item: list_item, index: index, size: current_list_items.size} %>
      <% end %>
    <% end %>
  </div>

  <div class="cf mv4">
    <hr class="mw5 center mv4"/>
    <h4>Add New Section To This Page:</h4>
    <%
       available_list_items = ListItem.available_styles(current_list_items.map(&:style_cd))
       classname = if available_list_items.keys.length == 3
                     "w-third-ns pv4"
                   elsif available_list_items.keys.length == 4
                     "w-25-ns  pv3"
                   elsif available_list_items.keys.length == 5
                     "w-20-ns pv2"
                   else
                     "w-sixth-ns pv2"
                   end

    %>

    <% available_list_items.each do |name, id| %>
      <%= button_to(account_list_items_path(current_account, current_list, list_item: {style_cd: id}), method: :post,
        class: "fl db w-100 #{classname} hide-child") do %>
        <div class="child cf w-100 h-100 absolute bg-blue tc white f3">
          <div class="dt w-100 h-100">
            <div class="dtc v-mid">
              <p class="f5 fw1"><%= t("list_items.style.#{name}") %></p>
            </div>
          </div>
        </div>
        <small class="db tc">Add</small>
        <h3 class="f3 fw3 mt0"><%= name.to_s.titleize %></h3>
      <% end %>
    <% end %>
  </div>


</div>

<script src="https://cdn.rawgit.com/basecamp/trix/e34a0db3c9e0ca303488227fceb6cd9b33cfdd09/dist/trix.js" charset="utf-8"></script>
<link rel="stylesheet" href="https://cdn.rawgit.com/basecamp/trix/e34a0db3c9e0ca303488227fceb6cd9b33cfdd09/dist/trix.css" media="screen" title="no title" charset="utf-8">
<script !src="">
  function reload() {
    window.location.reload()
  }

  function sortUp(id) {
    var current = $("#list_item_" + id);
    current.prev().before(current);
    sendSort()
  }

  function sortDown(id) {
    var current = $("#list_item_" + id);
    current.next().after(current);
    sendSort()
  }

  function sendSort() {
    $.rails.ajax({
      url: "<%= sort_account_list_items_path(current_account, current_list) %>",
      type: "POST",
      data: $("#sortable").sortable('serialize'),
    }).done(reload)
  }

  function sortable() {
    //create the sort function for list_items
    $("#sortable").sortable({update: sendSort});
  }

  function hideShowSubmit() {
    $("input[type='submit']").hide();
    $(document).on("focus change keyup blur", "input, textarea", function(e) {
      $(this).closest("form").find("input:submit").show();
    });
  }

  $(document).ready(sortable);
  //  $(document).ready(hideShowSubmit);
</script>

